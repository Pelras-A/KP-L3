"0","for(month in c(1,3,6)){"
"0"," "
"0","  "
"0","#PREDITS-------------------------------------------------------------------------------------------"
"0","new.data <- subset(data, select = -c(N,time,status))"
"0","surv3 <- NULL"
"0",""
"0",""
"0","for(i in 1:length(new.data$Age_L3)){"
"0","  "
"0","  "
"0",""
"0","      "
"0","      "
"0","  X <- new.data[i,]"
"0","  surv3 <- c(surv3,suppressWarnings(model_final(X)$table[model_final(X)$table$time==max(model_final(X)$table[model_final(X)$table$time<=month,]$time),]$pred))"
"0","}"
"0",""
"0","surv3_cate <- cut(surv3, breaks=c(quantile(surv3, probs = c(0, 0.25, 0.5, 0.75, 1),na.rm = F)),include.lowest = TRUE)"
"0",""
"0","new.table <- data.frame(surv3,surv3_cate)"
"0","#--------------------------------------------------------------------------------------------------"
"0",""
"0",""
"0",""
"0","new.data <- cbind(data, new.table)"
"0",""
"0",""
"0","#OBSERVES------------------------------------------------------------------------------------------"
"0","new.KM_1 <- survfit(Surv(new.data[new.data$surv3_cate==levels(surv3_cate)[1],]$time,"
"0","                         new.data[new.data$surv3_cate==levels(surv3_cate)[1],]$status==1) ~ 1,"
"0","                    type = ""kaplan-meier"","
"0","                    error = ""greenwood"")"
"0","new.KM_2 <- survfit(Surv(new.data[new.data$surv3_cate==levels(surv3_cate)[2],]$time,"
"0","                         new.data[new.data$surv3_cate==levels(surv3_cate)[2],]$status==1) ~ 1,"
"0","                    type = ""kaplan-meier"","
"0","                    error = ""greenwood"")"
"0","new.KM_3 <- survfit(Surv(new.data[new.data$surv3_cate==levels(surv3_cate)[3],]$time,"
"0","                         new.data[new.data$surv3_cate==levels(surv3_cate)[3],]$status==1) ~ 1,"
"0","                    type = ""kaplan-meier"","
"0","                    error = ""greenwood"")"
"0","new.KM_4 <- survfit(Surv(new.data[new.data$surv3_cate==levels(surv3_cate)[4],]$time,"
"0","                         new.data[new.data$surv3_cate==levels(surv3_cate)[4],]$status==1) ~ 1,"
"0","                    type = ""kaplan-meier"","
"0","                    error = ""greenwood"")"
"0",""
"0","#--------------------------------------------------------------------------------------------------"
"0",""
"0","#predit"
"0","x = sapply(split(new.table$surv3, new.table$surv3_cate), mean)"
"0","#observe"
"0","y = c(summary(new.KM_1, time = month)$surv,"
"0","      summary(new.KM_2, time = month)$surv,"
"0","      summary(new.KM_3, time = month)$surv,"
"0","      summary(new.KM_4, time = month)$surv)"
"0",""
"0","up <- c(summary(new.KM_1, time = month)$upper,"
"0","        summary(new.KM_2, time = month)$upper,"
"0","        summary(new.KM_3, time = month)$upper,"
"0","        summary(new.KM_4, time = month)$upper)"
"0",""
"0","down <- c(summary(new.KM_1, time = month)$lower,"
"0","          summary(new.KM_2, time = month)$lower,"
"0","          summary(new.KM_3, time = month)$lower,"
"0","          summary(new.KM_4, time = month)$lower)"
"0",""
"0","graph <- ggplot(data = data.frame(x,y)) +"
"0","  aes(x, y) +"
"0","  labs(x = ""Predicted"","
"0","       y = ""Observed"") +"
"0","  geom_point(color = ""blue"", size =2) +"
"0","  xlim(c(0,1)) +"
"0","  ylim(c(0,1)) +"
"0","  geom_errorbar(aes(ymin=down, ymax=up), width=.01,"
"0","                 position=position_dodge(0.05)) +"
"0","  "
"0","  geom_abline(intercept = 0,"
"0","              slope = 1)+"
"0","  theme_light() +"
"0","  theme(axis.text.x = element_text(size=14),"
"0","        axis.text.y = element_text(size=14),"
"0","        axis.title.x = element_text(size=14),"
"0","        axis.title.y = element_text(size=14))"
"0",""
"0","print(graph)"
"0",""
"0","}"
"2","
"
